define("js/app/controller/indiana/IndianaPay",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog","js/app/util/dict","js/app/module/loading/loading"],function(a,e,n,t,i){$(function(){function n(){t()}function t(){return e.get("802503",{userId:a.getUserId()}).then(function(e){if(e.success){var n=e.data;n.forEach(function(e){"CNY"==e.currency?p=a.formatMoneyD(e.amount):"CGB"==e.currency?m=a.formatMoneyD(e.amount):"CGJF"==e.currency&&(y=a.formatMoneyD(e.amount))}),s()}})}function s(){function n(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:u.data.appId,timeStamp:u.data.timeStamp,nonceStr:u.data.nonceStr,"package":u.data.wechatPackage,signType:u.data.signType,paySign:u.data.paySign},function(e){i.hideLoading(),"get_brand_wcpay_request:ok"==e.err_msg?(a.showMsg("支付成功"),setTimeout(function(){location.href="../indiana/detail.html?code="+c},1e3)):a.showMsg("支付失败")})}function t(e){u=e,u.data&&u.data.signType?"undefined"==typeof WeixinJSBridge?document.addEventListener?(document.removeEventListener("WeixinJSBridgeReady",n),document.addEventListener("WeixinJSBridgeReady",n,!1)):document.attachEvent&&(document.detachEvent("WeixinJSBridgeReady",n),document.detachEvent("onWeixinJSBridgeReady",n),document.attachEvent("WeixinJSBridgeReady",n),document.attachEvent("onWeixinJSBridgeReady",n)):n():(i.hideLoading(),a.showMsg(data.msg||"微信支付失败"))}if("CNY"==r){var s="";s+='<div class="b_bd_tb ptb10  bg_fff p_r s_12"><img src="/static/images/余额.png" class="va-m wp22p ml10"><span class="pl4 inline_block va-m">余额支付(余额：<span id="rmbRemain">￥'+p+'</span>)</span><input checked class="ab ab_r20 buyWay"  value="yePay" type="radio" name="buy"/></div><div class="b_bd_tb ptb10  bg_fff p_r s_12"><img src="/static/images/weixin-qq-icon.png" class="va-m wp22p ml10"><span class="pl4 inline_block va-m">微信支付</span><input class="ab  ab_r20 buyWay" value="wxPay" type="radio" name="buy"/></div>',$(".MoneyType").text("元"),$(".payWaysWrap").append(s)}else if("CGB"==r){var s="";s+='<div class="b_bd_tb ptb10  bg_fff p_r s_12"><img src="/static/images/余额.png" class="va-m wp22p ml10"><span class="pl4 inline_block va-m">余额支付(余额：<span id="rmbRemain">'+m+'菜狗币</span>)</span><input checked class="ab ab_r20 buyWay"  value="yePay" type="radio" name="buy"/></div>',$(".MoneyType").text("菜狗币"),$(".payWaysWrap").append(s)}else{var s="";s+='<div class="b_bd_tb ptb10  bg_fff p_r s_12"><img src="/static/images/余额.png" class="va-m wp22p ml10"><span class="pl4 inline_block va-m">余额支付(余额：<span id="rmbRemain">'+y+'抵金券</span>)</span><input checked class="ab ab_r20 buyWay"  value="yePay" type="radio" name="buy"/></div>',$(".MoneyType").text("抵金券"),$(".payWaysWrap").append(s)}s=$(s);var d;$("#toPay").on("click",function(){var n=$("body").find(".buyWay:checked").val();"wxPay"==n?d=5:"yePay"==n?d=90:a.showMsg("请选择支付方式");var i=sessionStorage.getItem("userId");e.getIp().then(function(n){var s={userId:i,jewelCode:c,times:o,payType:d,ip:n.ip};e.post("615020",{json:s}).then(function(e){e.success?5==d?t(e):(a.showMsg("支付成功"),setTimeout(function(){location.href="../indiana/indiana.html"},800)):"CGJF"==r&&"账户余额不足"==e.msg?a.confirm("抵金券余额不足，是否前往兑换？","否","是").then(function(){location.href="../user/buyIntegral.html"},function(){}):"CNY"==r&&"账户余额不足"==e.msg?a.confirm("账户余额不足，是否前往充值？","否","是").then(function(){location.href="../pay/cny_recharge.html"},function(){}):"CGB"==r&&"账户余额不足"==e.msg?a.confirm("菜狗币余额不足，是否前往充值？","否","是").then(function(){location.href="../pay/buyCgM.html"},function(){}):a.showMsg(e.msg)})})});var u={}}var c=a.getUrlParam("code"),o=a.getUrlParam("times"),r=a.getUrlParam("fromCurrency"),d=a.getUrlParam("moneyOne"),p=0,m=0,y=0,u=o*d;$(".times").text(o),$(".totalMoney").text(a.formatMoneyD(u)),n()})});