define("js/app/controller/indiana/IndianaDetail",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog","js/app/util/dict"],function(t,a){function n(){$(".close").click(function(){$(".Mpopup").css("display","none")}),s&&($(".ifBuyed").hide(),$(".ifBuyedDiv").hide()),$(".introduce").on("click",function(){location.href="introduce.html"});var n=t.getUrlParam("code"),d={code:n};$.when(a.post("615016",{json:d}),t.getSysConfig("807717","treasure_statement"),t.getDictList("802006","currency")).then(function(s,d,l){if(s.success&&d.success&&l.success){$(".MZContent").html(d.data.note);var r=l.data;data=s.data;var c=data.fromAmount,m=data.totalNum-data.investNum,u=data.fromCurrency,p=data.templateCode;if(o=data.maxNum,$(".indianaDetail-banner").find("img").attr("src",PIC_PREFIX+data.advPic),"CNY"==data.toCurrency)var f=t.formatMoneyD(data.toAmount)+"元";else if("CGB"==data.toCurrency)var f=t.formatMoneyD(data.toAmount)+"菜狗币";else var f=t.formatMoneyD(data.toAmount)+"抵金券";$(".money .MoneyType").text("CNY"==data.fromCurrency?"元":"CGB"==data.fromCurrency?"菜狗币":"抵金券"),$(".indianaDetail_1").find(".span").text(f),$(".indianaDetail_1").find(".slogan").text(data.slogan),$(".indianaDetail_2").find(".maxNum").html("单人最大投资<i>"+o+"</i>次"),$(".indianaDetail_2").find("span").text(data.periods),$(".indianaDetail_4").find(".total").text(data.totalNum),$(".indianaDetail_4").find(".surplus").text(m);var y=data.totalNum,v=data.investNum,h=v/y*100;$(".wrapDiv").find("div").css("width",+h+"%"),$(".history").on("click",function(){location.href="history.html?templateCode="+p});var D=$(".i").text(),g=c;$(".money .totalMoney").text(t.formatMoneyD(g)),$(".max").on("click",function(){o>m?($(".i").text(m),D=m,g=D*c,$(".money .totalMoney").text(t.formatMoneyD(g))):(D=o,g=D*c,$(".i").text(o),$(".money .totalMoney").text(t.formatMoneyD(g)))}),$(".sub").on("click",function(){1>=D?D=1:D--,$(".i").text(D),g=D*c,$(".money .totalMoney").text(t.formatMoneyD(g))}),$(".add").on("click",function(){D>=m||D>=o?D=Math.min(m,o):D++,$(".i").text(D),g=D*c,$(".money .totalMoney").text(t.formatMoneyD(g))}),$(".toJion").on("click",function(){i?($(".MZSM").css("display","block"),$(".MZSM button").on("click",function(){location.href="../pay/pay.html?code="+data.code+"&times="+D+"&fromCurrency="+u+"&moneyOne="+c})):(returnUrl="../indianaDetail.html",location.href="../user/login.html?return="+encodeURIComponent(location.pathname+location.search))});var M={companyCode:COMPANYCODE,start:"1",limit:"20",status:"123",jewelCode:n};a.post("615025",{json:M}).then(function(a){if(a.success){for(var n=a.data.list,i="",o="",s=0;s<n.length;s++){var d=n[s],l="",c=d.payDatetime;""!==$(".indianaRecord_name span").text()&&$(".indianaRecord_name span").text("("+c+"开始）");var m=d.payDatetime.substring(0,10),u=d.user.mobile.substring(0,3)+"*****"+d.user.mobile.substring(8,11),p=d.times,f=d.ip,c=d.payDatetime,y='参与<i class="result">'+p+"</i>次夺宝",v='中了<i class="result">'+d.jewel.toAmount/1e3+e(d.jewel.toCurrency,r)+"</i>大奖";if(i!==m&&(l+="<div class='time'><p class='pz9'>"+m+"</p><div class='d-hr'></div></div>",i=m),l+='<div class="li"><div class="detail"><div class="d-hr"></div>',l+='<div class="img pz9"><img src="/static/images/defaultImg.png" alt=""></div>',l+='<div class="personInfo"><p class="name">'+u+"</p>",l+='<p class="ip"><span>'+f+"</span></p>",2==d.status){var h=l;l+='<p class="ifGet"><span>'+v+"</span>",l+='<span class="data">'+c+"</span></p></div></div></div>",l+=h}l+='<p class="ifGet"><span>'+y+"</span>",l+='<span class="data">'+c+"</span></p></div></div></div>",o+=l}$(".indianaDetail_record_detail").append(o)}else t.showMsg(a.msg)}),$("#cont").hide()}else $("#cont").hide(),t.showMsg("暂时无法获取商品详情！")})}function e(t,a){for(var n=0;n<a.length;n++)if(t==a[n].dkey)return a[n].dvalue}var i=t.getUserId(),o=0,s=t.getUrlParam("d");n()});