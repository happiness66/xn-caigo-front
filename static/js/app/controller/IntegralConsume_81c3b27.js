define("js/app/controller/IntegralConsume",["js/app/controller/base","js/app/util/ajax","js/lib/handlebars.runtime-v3.0.3"],function(n,o){function t(){d?i?($("#name").text(i),$("#loaddingIcon").addClass("hidden"),e(),s()):a():n.showMsg("未传入商家编号!")}function e(){return o.get("802503",{userId:n.getUserId()}).then(function(o){if(o.success){var t=o.data;t.forEach(function(o){"CGB"==o.currency&&$("#CGBRemain").html(n.formatMoney(o.amount))})}})}function a(){o.post("808218",{code:d}).then(function(o){if($("#cont").remove(),$("#loaddingIcon").addClass("hidden"),o.success){var t=o.data;$("#name").text(t.name),s()}else n.showMsg("无法获取商家信息!")})}function s(){$("#sbtn").on("click",function(){var o=$("#amount").val();o?0>=+o?n.showMsg("消费菜狗币必须大于0!"):($("#integral").text(o),$("#od-mask, #od-tipbox").removeClass("hidden")):n.showMsg("消费菜狗币不能为空!")}),$("#odOk").on("click",function(){c()}),$("#odCel").on("click",function(){$("#od-mask, #od-tipbox").addClass("hidden")})}function c(){$("#loaddingIcon").removeClass("hidden"),o.post("808242",{json:{storeCode:d,amount:1e3*+$("#amount").val(),payType:"90",userId:n.getUserId()}}).then(function(o){$("#loaddingIcon").addClass("hidden"),$("#od-mask, #od-tipbox").addClass("hidden"),o.success?n.confirm("支付成功,是否返回商家详情").then(function(){location.href="../consume/detail.html?c="+d},function(){}):"菜狗币账户余额不足"==o.msg?n.confirm("菜狗币余额不足，是否前往购买？","否","是").then(function(){location.href="../pay/buyCgM.html"},function(){n.confirm("支付成功,是否返回商家详情").then(function(){location.href="../consume/detail.html?c="+d},function(){})}):n.showMsg(o.msg)})}var d=n.getUrlParam("c")||"",i=n.getUrlParam("n");t()});