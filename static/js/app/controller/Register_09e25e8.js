define("js/app/controller/Register",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog"],function(n,e,t){$(function(){function i(){$("#captchaImg").click();var n="./login.html";m&&(n=n+"?return="+encodeURIComponent(m)),$("#toLogin").attr("href",n)}function a(){$("#mobile").on("change",s),$("#captcha").on("change",f),$("#registerBtn").on("click",function(){p()}),$("#captchaImg").on("click",function(){$(this).attr("src",APIURL+"/captcha?_="+(new Date).getTime())}),$("#verification").on("change",c),$("#password").on("change",r).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#getVerification").one("click",function n(){s()?o():$("#getVerification").one("click",n)})}function o(){$("#getVerification").addClass("cancel-send");var n={bizType:"805041",mobile:$("#mobile").val(),kind:"f1"};e.post("805904",{json:n}).then(function(n){if(n.success)for(var e=0;60>=e;e++)!function(n){setTimeout(function(){60>n?$("#getVerification").text(60-n+"s"):$("#getVerification").text("获取验证码").removeClass("cancel-send").one("click",function e(){s()&&f()?o():$("#getVerification").one("click",e)})},1e3*n)}(e);else $("#captchaImg").click(),$("#getVerification").one("click",function t(){s()&&f()?o():$("#getVerification").one("click",t)}),g(n.msg)})}function c(){var n,e=$("#verification")[0],t=e.parentNode;return""==e.value?(n=$(t).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^[\d]{4}$/.test(e.value)?!0:(n=$(t).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function r(){var n,e=$("#password")[0],t=e.parentNode,i=/^[^\s]{6,16}$/;return""==e.value?(n=$(t).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):i.test(e.value)?!0:(n=$(t).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function s(){var n,e=$("#mobile"),t=e.parent();return""==e.val()?(n=t.find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^1[3,4,5,7,8]\d{9}$/.test(e.val())?!0:(n=t.find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function f(){var n,e=$("#captcha"),t=e.parent();return""==e.val()?(n=t.find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^[\d,a-z,A-Z]{4}$/.test(e.val())?!0:(n=t.find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function l(){return s()&&r()&&c()?!0:!1}function u(){var t={mobile:$("#mobile").val(),isRegHx:"0",loginPwd:$("#password").val(),smsCaptcha:$("#verification").val(),kind:"f1",loginPwdStrength:n.calculateSecurityLevel($("#password").val())};e.post(805041,{json:t}).then(function(n){if(n.success){var e=0;(e=n.data.amount)?(g("恭喜您注册成功<br/>获得抵金券+"+ +e/1e3,3e3),setTimeout(function(){d()},1e3)):(g("恭喜您注册成功！"),d())}else $("#captchaImg").click(),g(n.msg),$("#registerBtn").removeAttr("disabled").val("注册")})}function d(){var n={loginName:$("#mobile").val(),loginPwd:$("#password").val(),terminalType:"1"},t="805043";e.post(t,{json:n}).then(function(n){n.success?(sessionStorage.setItem("user","1"),location.href=m||"./user_info.html"):(sessionStorage.setItem("user","0"),location.href="./login.html?return="+encodeURIComponent(m))})}function g(n,e){var i=t({content:n,quickClose:!0});i.show(),setTimeout(function(){i.close().remove()},e||2e3)}function p(){l()&&(v=1,$("#registerBtn").attr("disabled","disabled").val("注册中..."),u())}{var v=1,m=n.getUrlParam("return");n.getUrlParam("u")}a(),i()})});