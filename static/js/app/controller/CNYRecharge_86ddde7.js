define("js/app/controller/CNYRecharge",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading","js/app/module/validate/validate"],function(e,n,t){function a(){d(),t.createLoading(),$.when(i()).then(t.hideLoading,t.hideLoading)}function i(){return n.get("802503",{userId:e.getUserId()}).then(function(e){if(e.success){var n=e.data;n.forEach(function(e){"CNY"==e.currency&&(g=e.accountNumber)})}})}function d(){$("#sbtn").click(function(){$("#cgbAmount").val()?(s=1e3*$("#cgbAmount").val(),o(5)):e.showMsg("请输入充值金额")}),$("#bankcardNumber").on("change",function(){$("#bankcardNumberSpan").html($(this).val())})}function o(a){t.createLoading("充值中..."),n.post("802530",{json:{userId:e.getUserId(),amount:s,payType:a}}).then(function(n){n.success?r(n.data):(t.hideLoading(),e.showMsg(n.msg))})}function c(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:u.appId,timeStamp:u.timeStamp,nonceStr:u.nonceStr,"package":u.wechatPackage,signType:u.signType,paySign:u.paySign},function(n){t.hideLoading(),"get_brand_wcpay_request:ok"==n.err_msg?(e.showMsg("支付成功"),setTimeout(function(){e.getBack()},1e3)):e.showMsg("支付失败")})}function r(n){u=n,n&&n.signType?"undefined"==typeof WeixinJSBridge?document.addEventListener?(document.removeEventListener("WeixinJSBridgeReady",c),document.addEventListener("WeixinJSBridgeReady",c,!1)):document.attachEvent&&(document.detachEvent("WeixinJSBridgeReady",c),document.detachEvent("onWeixinJSBridgeReady",c),document.attachEvent("WeixinJSBridgeReady",c),document.attachEvent("onWeixinJSBridgeReady",c)):c():(t.hideLoading(),e.showMsg(n.msg||"微信支付失败"))}var g,s=(e.getUrlParam("c"),0);a();var u={}});