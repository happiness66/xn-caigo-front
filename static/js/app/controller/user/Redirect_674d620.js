define("js/app/controller/user/Redirect",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading","js/app/module/judgeBindMobile/judgeBindMobile","js/app/module/bindMobileSms/bindMobile"],function(e,o,s,n,i){function t(){var o=e.getUrlParam("code");return o?void(e.isLogin()?setTimeout(function(){e.goBackUrl()},1e3):(s.createLoading("登录中..."),r({code:o,mobile:d,smsCaptcha:c,userReferee:u,companyCode:SYSTEM_CODE}))):(s.createLoading(),void a())}function a(){o.get("806031",{companyCode:SYSTEM_CODE,account:"ACCESS_KEY",type:"3"}).then(function(o){if(o.success&&o.data.length){var n=o.data[0].password,i=encodeURIComponent(e.getDomain()+"/user/redirect.html?m="+d+"&s="+c);s.hideLoading(),location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+n+"&redirect_uri="+i+"&response_type=code&scope=snsapi_userinfo#wechat_redirect"}else s.hideLoading(),e.showMsg(o.msg||"非常抱歉，微信登录失败")},function(){s.hideLoading(),e.showMsg("非常抱歉，微信登录失败")})}function r(t){o.post("805151",{json:t}).then(function(o){if(o.success)if(null==o.data.userId||""==o.data.userId)s.hideLoading(),n.addCont({success:function(e,o){d=e,c=o,a()}}).showCont();else{s.hideLoading(),e.setSessionUser(o);var r=sessionStorage.getItem("returnFUrl");location.href=r?1==sessionStorage.getItem("flagHb")?"../shake/share-receive.html?code="+sessionStorage.getItem("hbCode")+"&userReferee="+u:2==sessionStorage.getItem("flagHb")?"../index.html?userReferee="+u:r:"./user_info.html"}else s.hideLoading(),e.showMsg(o.msg),setTimeout(function(){i.addMobileCont({mobile:t.mobile,success:function(e,o){d=e,c=o,a()},error:function(o){e.showMsg(o)},hideBack:1}).showMobileCont()},1e3)},function(){s.hideLoading(),e.showMsg("非常抱歉，微信授权失败!")})}var d=e.getUrlParam("m")||"",c=e.getUrlParam("s")||"",u=sessionStorage.getItem("userReferee")||"";""==u&&(u=SYSTEM_USERID),t()});