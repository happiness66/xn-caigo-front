define("js/app/controller/user/BuyIntegral",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading"],function(n,e,t){function o(){i(),t.createLoading(),$.when(a(),r()).then(t.hideLoading,t.hideLoading)}function r(){return u("CGB","CGJF")}function u(n,t){return e.get("002051",{fromCurrency:n,toCurrency:t}).then(function(n){s=n.data.rate})}function a(){return e.get("802503",{userId:n.getUserId()}).then(function(e){if(e.success){var t=e.data;t.forEach(function(e){"CGB"==e.currency&&$("#reaminCGB").html(n.formatMoney(e.amount)+" , 1菜狗币兑换"+s+"抵金券")})}})}function i(){$("#jfAmount").on("keyup",function(){var e=$(this),t=e.val();$.isNumeric(t)?(d=1e3*t,$("#needAmount").val(n.formatMoney(d/s))):(d=0,$("#needAmount").val(0))}),$("#sbtn").click(function(){c()})}function c(){t.createLoading("支付中..."),e.post("802412",{json:{fromAmount:1e3*$("#needAmount").val(),fromCurrency:"CGB",userId:n.getUserId(),toCurrency:"CGJF"}}).then(function(e){t.hideLoading(),e.success?(n.showMsg("抵金券购买成功"),setTimeout(function(){n.getBack()},1e3)):(t.hideLoading(),n.showMsg(e.msg))})}var s=1,d=0;o()});