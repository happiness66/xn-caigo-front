define("js/app/controller/user/AddBankCard",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading","js/app/module/validate/validate"],function(a,e,n){function o(){return a.isLogin()?(n.createLoading(),$("#userId").val(a.getUserId()),i(),void t()):void a.goLogin()}function t(){e.get("802116").then(function(e){if(n.hideLoading(),e.success){for(var o="",t=0;t<e.data.length;t++)o+='<option value="'+e.data[t].bankName+'" code="'+e.data[t].bankCode+'">'+e.data[t].bankName+"</option>";$("#bankName").html(o)}else a.showMsg(e.msg)})}function i(){$("#bankCardForm").validate({rules:{realName:{required:!0,isNotFace:!0,maxlength:16},bankName:{required:!0},subbranch:{required:!0,isNotFace:!0,maxlength:255},bindMobile:{required:!0,mobile:!0},bankcardNumber:{required:!0,bankCard:!0}},onkeyup:!1}),$("#sbtn").on("click",function(){$("#bankCardForm").valid()&&r()}),$("#bankName").on("change",function(){$("#bankNameSpan").html($("#bankName").val()),$("#bankCode").val($("#bankName option:selected").attr("code"))})}function r(){n.createLoading("保存中...");var o=$("#bankCardForm").serializeObject();e.post("802010",{json:o}).then(function(e){n.hideLoading(),e.success?(a.showMsg("添加银行卡成功"),setTimeout(function(){s?location.href=d:a.getBack()},1e3)):a.showMsg(e.msg)})}var d=sessionStorage.getItem("returnhref"),s=a.getUrlParam("return");o()});