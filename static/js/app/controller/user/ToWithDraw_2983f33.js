define("js/app/controller/user/ToWithDraw",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading","js/app/module/validate/validate"],function(e,t,n){function a(){n.createLoading(),jQuery.validator.addMethod("gt1",function(e){var t=!1,n=i;return e=1e3*+e,n>=e&&""!=e&&(t=!0),t},"提现金额不能大于账户余额"),$.when(o(),r(),u()).then(function(){n.hideLoading()},n.hideLoading),s()}function r(){return t.get("802016",{userId:e.getUserId(),status:"1"}).then(function(t){if(n.hideLoading(),t.success)if(t.data.length){var a="";t.data.forEach(function(e){a+='<option value="'+e.bankcardNumber+'">'+e.bankcardNumber+"</option>"}),$("#bankcardNumber").html(a).trigger("change")}else e.showMsg("请先绑定银行卡"),sessionStorage.setItem("returnhref",location.href),setTimeout(function(){location.replace("./add_bankCard.html?return=1")},1e3);else e.showMsg(t.msg)})}function o(){return t.get("802503",{userId:e.getUserId()}).then(function(t){if(t.success){var n=t.data;n.forEach(function(t){"CNY"==t.currency&&($("#accountNumber").val(t.accountNumber),i=+t.amount,$("#remainAmount").val(e.formatMoney(t.amount)))})}})}function u(){t.get("802025",{start:1,limit:15,type:"2"}).then(function(e){e.success&&e.data.list.forEach(function(e){"cuserQxfl"==e.ckey&&$("#cuserQxfl").text(100*e.cvalue),"cuserQxsx"==e.ckey&&$("#cuserQxsx").text(e.cvalue),"cuserQxbs"==e.ckey&&(d=e.cvalue,$("#cuserQxbs1").text(e.cvalue),$("#cuserQxbs").text(e.cvalue))})})}function s(){$("#withDrawForm").validate({rules:{transAmount:{required:!0,isPositive:!0,gt1:!0},bankcardNumber:{required:!0},tradePwd:{required:!0,isNotFace:!0,maxlength:255}},onkeyup:!1}),$("#sbtn").click(function(){$("#withDrawForm").valid()&&(+$("#transAmount").val()<d?e.showMsg("提现金额不能小于"+d):c())}),$("#bankcardNumber").on("change",function(){$("#bankcardNumberSpan").html($(this).val())})}function c(){var n=$("#withDrawForm").serializeObject();n.transAmount=1e3*-n.transAmount,t.post("802526",{json:n}).then(function(t){t.success?(e.showMsg("提交成功"),setTimeout(function(){e.getBack()},1e3)):e.showMsg(t.msg)})}var i=0,d=0;a()});