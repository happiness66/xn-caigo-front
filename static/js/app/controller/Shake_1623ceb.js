define("js/app/controller/Shake",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog","js/lib/fingerprint2","js/app/module/loading/loading"],function(t,e,n,s,o){function a(){o.createLoading("定位中..."),r=sessionStorage.getItem("longitude")||"",p=sessionStorage.getItem("latitude")||"",r?(o.createLoading("加载中..."),c()):t.getInitLocation(function(){r=sessionStorage.getItem("longitude"),p=sessionStorage.getItem("latitude"),o.createLoading("加载中..."),c()},function(){o.hideLoading(),t.showMsg("定位失败",1e3)}),$(".play-way").on("click",function(){$(".playWays").css("display","block"),$(".playWays button").on("click",function(){$(".playWays").css("display","none")})}),$(".close").click(function(){$(".Mpopup").css("display","none")})}function i(){t.getSysConfig("807717","yyy_rule").then(function(t){$(".playWays-Content").html(t.data.note)})}function c(){var n={userId:h,token:f,longitude:r,latitude:p};e.post("805158",{json:n}).then(function(e){o.hideLoading(),e.success?l():t.showMsg(e.msg)})}function l(){if(window.DeviceMotionEvent){var t=15,e=y=z=lastX=lastY=lastZ=0;window.addEventListener("devicemotion",function(){var n=event.accelerationIncludingGravity;e=n.x,y=n.y,z=n.z,(Math.abs(e-lastX)>t||Math.abs(y-lastY)>t)&&1==m&&(m=0,o.showLoading("加载中..."),d()),lastX=e,lastY=y,lastZ=z},!1)}}function d(){var n={longitude:r,latitude:p,userId:h,deviceNo:u,companyCode:COMPANYCODE,token:f};e.post("615117",{json:n}).then(function(e){o.hideLoading(),e.success?""!=e.data?(setTimeout(function(){m=1},500),location.href="shake/shake-list.html"):(m=1,t.showMsg("附近没有摇钱树可以摇！")):g(e.msg)})}function g(t){$("<div class='wp100 hp100 pat0 bg_0_8 z_index9999' id='shakeAfterSta1'><div class='wp100'><img src='/static/images/xin-.png'/><p class='c_fe4332 fs20r pt40_b20r'>"+t+"</p></div></div>").appendTo("body"),$("#shakeAfterSta1").addClass("active"),setTimeout(function(){$("#shakeAfterSta1").remove(),m=1},2e3)}var u,r,p,f=(sessionStorage.getItem("user"),sessionStorage.getItem("token")),h=sessionStorage.getItem("userId"),m=1;(new s).get(function(t){u=t,a()}),i()});