define("js/app/controller/FindTradePwd",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog"],function(n,e,i){$(function(){function n(){t()}function t(){$("#verification").on("change",s),$("#password").on("change",o).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#repassword").on("change",r).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#sbtn").on("click",function(){u()}),$("#getVerification").one("click",a)}function a(){$("#getVerification").addClass("cancel-send"),e.post(APIURL+"/gene/findtradepwd/send",{mobile:sessionStorage.getItem("m")}).then(function(n){if(n.success)for(var e=0;60>=e;e++)!function(n){setTimeout(function(){60>n?$("#getVerification").text(60-n+"s"):$("#getVerification").text("获取验证码").removeClass("cancel-send").one("click",a)},1e3*n)}(e);else{$("#getVerification").one("click",a);var i=$("#verification").parent(),t=i.find("span.warning")[2];$(t).fadeIn(150).fadeOut(3e3)}})}function s(){var n,e=$("#verification")[0],i=e.parentNode;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^[\d]{4}$/.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function o(){var n,e=$("#password")[0],i=e.parentNode,t=/^[^\s]{6,16}$/;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):t.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function r(){var n,e=$("#password")[0],i=$("#repassword")[0],t=i.parentNode;return""==i.value?(n=$(t).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):i.value!==e.value?(n=$(t).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1):!0}function c(){return s()&&o()&&r()?!0:!1}function f(n){var e=i({content:n,quickClose:!0});e.show(),setTimeout(function(){e.close().remove()},2e3)}function d(){$("#sbtn").text("设置"),f("恭喜您，交易密码设置成功！"),setTimeout(function(){location.href="./user_info.html"},1e3)}function u(){if(c()){$("#sbtn").attr("disabled","disabled").text("设置中...");var n={newTradePwd:$("#password").val(),smsCaptcha:$("#verification").val()};e.post(APIURL+"/user/tradepwd/find",n).then(function(n){n.success?d():($("#sbtn").removeAttr("disabled").text("设置"),f(n.msg))})}}n()})});