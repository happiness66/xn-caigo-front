define("js/app/controller/new/SureBuyed",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog","js/app/util/dict","js/app/module/loading/loading"],function(e,n,t,a,i){function o(){d(),c()}function d(){return n.get("802503",{userId:e.getUserId()}).then(function(n){if(n.success){var t=n.data;t.forEach(function(n){"CNY"==n.currency&&$("#rmbRemain").html("¥"+e.formatMoney(n.amount))})}})}function c(){function t(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:c.appId,timeStamp:c.timeStamp,nonceStr:c.nonceStr,"package":c.wechatPackage,signType:c.signType,paySign:c.paySign},function(n){i.hideLoading(),"get_brand_wcpay_request:ok"==n.err_msg?(e.showMsg("支付成功"),setTimeout(function(){location.href="../new/hadBuyed.html"},1e3)):e.showMsg("支付失败")})}function a(n){c=n,n&&n.signType?"undefined"==typeof WeixinJSBridge?document.addEventListener?(document.removeEventListener("WeixinJSBridgeReady",t),document.addEventListener("WeixinJSBridgeReady",t,!1)):document.attachEvent&&(document.detachEvent("WeixinJSBridgeReady",t),document.detachEvent("onWeixinJSBridgeReady",t),document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t():(i.hideLoading(),e.showMsg(n.msg||"微信支付失败"))}var o=sessionStorage.getItem("userId"),d=(sessionStorage.getItem("token"),e.getUrlParam("price"));$(".price").text(d),$("#payNum").text("￥"+d),$("#sureBuyed").on("click",function(){var t,i=e.getUrlParam("hzbTemplateCode"),d=$("input[name='buy']:checked").val();"wxPay"==d?t=5:"yePay"==d?t=1:e.showMsg("请选择支付方式");var c={userId:o,payType:t,hzbTemplateCode:i};n.post("615111",{json:c}).then(function(n){n.success?5==t?a(n.data):(e.showMsg("支付成功"),setTimeout(function(){location.href="../new/hadBuyed.html"},1e3)):"账户余额不足"==n.msg?e.confirm("账户余额不足，是否前往充值？","否","是").then(function(){location.href="../pay/cny_recharge.html"},function(){}):e.showMsg(n.msg)})});var c={}}o()});