define("js/app/controller/new/IndianaSecord",["js/app/controller/base","js/app/util/ajax","js/app/util/dict"],function(a,i){function n(){s(),e()}function s(){var n={companyCode:COMPANYCODE,userId:a.getUserId(),status:"1",start:o,limit:r};i.post("615027",{json:n}).then(function(i){if(i.success){if(0==i.data.list&&1==o)return a.showMsg("您暂时还没有夺宝记录"),void $("#cont").hide();var n=i.data.list,s=+i.data.totalCount;(r>=s||n.length<r)&&(l=!0);for(var e="",d=0;d<n.length;d++){var c=n[d],u="",v=c.totalNum-c.investNum;if("CNY"==c.toCurrency)var m=c.toAmount/1e3+"元";else if("CGB"==c.toCurrency)var m=c.toAmount/1e3+"菜狗币";else var m=c.toAmount/1e3+"抵金券";var h=c.totalNum,f=c.investNum,j=f/h*1.55,g=c.code;u+='<li data-code="'+g+'"><div class="wrap"><div class="indiana-num">第<span id="periods">'+c.periods+"</span>期</div>",u+='<div class="indiana-has"><span id="toAmount">'+m+'</span><div class="wrapDiv"><div style="width:'+j+'rem;"></div></div></div>',u+='<div class="indiana-person"><p>总需人次</p><p class="num" id="totalNum">'+c.totalNum+"</p></div>",u+='<div class="indiana-last"><p>剩余人次</p><p class="num">'+v+"</p></div>",u+='<div class="indiana-price"><p>单价</p><p class="num" id="fromAmount">'+c.fromAmount/1e3+"</p></div></div>",u+='<div class="fs13 joinWrap hidden"></div></li>',e+=u,t()}$(".indianaDetail").append(e),$("#cont").hide(),o++}else $("#cont").hide(),a.showMsg("您暂时还没有夺宝记录");p=!0})}function e(){$(".indianaDetail").on("click","li",function(){var n=$(this),s=$(this).attr("data-code");n.children(".joinWrap").hasClass("in")?n.children(".joinWrap").hasClass("hidden")?n.children(".joinWrap").removeClass("hidden"):n.children(".joinWrap").addClass("hidden"):$.when(i.get("615029",{userId:a.getUserId(),jewelCode:s}),i.get("615016",{code:s})).then(function(i,s){if(i.success&&s.success){var e=i.data.length,d=i.data;if(s.data.winNumber)var t=s.data.user.mobile.substring(0,3)+"*****"+s.data.user.mobile.substring(8,11),o='<p class="joinWrap_p2">中奖人: '+t+'</p><p class="joinWrap_p2">中奖号码: '+s.data.winNumber+'</p><p class="joinWrap_p2">揭晓时间: '+a.formatDate(s.data.winDatetime,"yyyy-MM-dd")+'</p><p class="b_e_b joinWrap_p1">我已参与<i>'+e+"</i>次，以下是所有夺宝记录</p><p>";else var o='<div class="fs13 joinWrap"><p class="b_e_b joinWrap_p1">我已参与<i>'+e+"</i>次，以下是所有夺宝记录</p><p>";for(var r=0;r<d.length;r++){var l=d[r],p="";p+="<span>"+l.number+"</span>",o+=p}n.children(".joinWrap").append(o+"</p>"),n.children(".joinWrap").addClass("in"),n.children(".joinWrap").removeClass("hidden")}})}),$(window).on("scroll",function(){p&&!l&&$(document).height()-$(window).height()-10<=$(document).scrollTop()&&(p=!1,d(),s())})}function d(){$(".indianaDetail").append('<p class="scroll-loadding"></p>')}function t(){$(".indianaDetail").find(".scroll-loadding").remove()}var o=(a.getUrlParam("templateCode"),1),r=10,l=!1,p=!1;n()});