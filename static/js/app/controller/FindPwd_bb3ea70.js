define("js/app/controller/FindPwd",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog"],function(n,e,i){$(function(){function a(){$("#mobile").on("change",u),$("#verification").on("change",l),$("#password").on("change",d).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#repassword").on("change",p).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#sbtn").on("click",function(){s()}),$("#getVerification").one("click",function n(){u()?t():$("#getVerification").one("click",n)})}function t(){$("#getVerification").addClass("cancel-send"),param={bizType:"805048",mobile:$("#mobile").val(),kind:"f1"},e.post("805904",{json:param}).then(function(n){if(n.success)for(var e=0;60>=e;e++)!function(n){setTimeout(function(){60>n?$("#getVerification").text(60-n+"s"):$("#getVerification").text("获取验证码").removeClass("cancel-send").one("click",function(){u()&&t()})},1e3*n)}(e);else{$("#getVerification").one("click",function(){u()&&t()});var i=$("#verification").parent(),a=i.find("span.warning")[2];$(a).fadeIn(150).fadeOut(3e3)}})}function o(){param={mobile:$("#mobile").val(),kind:"f1"},e.post(805040,{json:param}).then(function(n){var e=$("#mobile").parent();if(n.success){var i=e.find("span.warning")[2];$(i).fadeIn(150).fadeOut(3e3)}else r()})}function s(){l()&&u()&&d()&&p()&&o()}function r(){$("#sbtn").attr("disabled","disabled").text("设置中..."),param={mobile:$("#mobile").val(),smsCaptcha:$("#verification").val(),loginPwdStrength:n.calculateSecurityLevel($("#password").val()),newLoginPwd:$("#password").val(),kind:"f1"},e.post(805048,{json:param}).then(function(n){n.success?f():($("#sbtn").removeAttr("disabled").text("设置"),c(n.msg))})}function c(n){var e=i({content:n,quickClose:!0});e.show(),setTimeout(function(){e.close().remove()},2e3)}function f(){$("#sbtn").text("设置"),c("恭喜您，密码设置成功！");var e,i=n.getUrlParam("return");e=i?"./login.html?return="+encodeURIComponent(i):"./login.html",setTimeout(function(){location.href=e},1e3)}function l(){var n,e=$("#verification")[0],i=e.parentNode;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^[\d]{4}$/.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function u(){var n,e=$("#mobile")[0],i=e.parentNode;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^1[3,4,5,7,8]\d{9}$/.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function d(){var n,e=$("#password")[0],i=e.parentNode,a=/^[^\s]{6,16}$/;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):a.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function p(){var n,e=$("#password")[0],i=$("#repassword")[0],a=i.parentNode;return""==i.value?(n=$(a).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):i.value!==e.value?(n=$(a).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1):!0}a()})});