define("js/app/controller/operator/SubmitOrder",["js/app/controller/base","js/app/util/ajax","js/app/util/dict","js/app/util/dialog","js/lib/handlebars.runtime-v3.0.3","js/app/module/loadImg/loadImg"],function(e,s,a,t,r,n){function l(){!function(){var e="805165",a={userId:g,token:_,isDefault:""},t=r.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,s,a,t){var r,n=s.helperMissing,l="function",o=this.escapeExpression;return'<a code="'+o((r=null!=(r=s.code||(null!=e?e.code:e))?r:n,typeof r===l?r.call(e,{name:"code",hash:{},data:t}):r))+'" class="show">\r\n    <p class="s_11 t_bold pr16">\r\n        <span id="addressee">'+o((r=null!=(r=s.addressee||(null!=e?e.addressee:e))?r:n,typeof r===l?r.call(e,{name:"addressee",hash:{},data:t}):r))+'</span>\r\n        <span id="mobile" class="pl10">'+o((r=null!=(r=s.mobile||(null!=e?e.mobile:e))?r:n,typeof r===l?r.call(e,{name:"mobile",hash:{},data:t}):r))+'</span>\r\n    </p>\r\n    <p class="s_10 pr16 t_323232">\r\n        <span class="pr10">'+o((r=null!=(r=s.province||(null!=e?e.province:e))?r:n,typeof r===l?r.call(e,{name:"province",hash:{},data:t}):r))+'</span><span class="pr10">'+o((r=null!=(r=s.city||(null!=e?e.city:e))?r:n,typeof r===l?r.call(e,{name:"city",hash:{},data:t}):r))+'</span>\r\n        <span class="pr10">'+o((r=null!=(r=s.district||(null!=e?e.district:e))?r:n,typeof r===l?r.call(e,{name:"district",hash:{},data:t}):r))+"</span>\r\n        <span>"+o((r=null!=(r=s.detailAddress||(null!=e?e.detailAddress:e))?r:n,typeof r===l?r.call(e,{name:"detailAddress",hash:{},data:t}):r))+'</span>\r\n    </p>\r\n    <i class="r-tip"></i>\r\n</a>'},useData:!0});s.post(e,{json:a}).then(function(e){if($("#cont").hide(),e.success){var s=e.data,a=s.length;if(a){for(var r=0;a>r&&"1"!=s[r].isDefault;r++);r==a&&(r=0),y=s[r];var n=t(s[r]);$("#addressDiv").append(n),$("#addressRight").removeClass("hidden")}else $("#noAddressDiv").removeClass("hidden")}else o("#addressDiv")})}(),1==h?d():2==h&&(v=v.split(/_/),i()),function(){s.get("805055",{kind:"05",status:"0"}).then(function(e){if(e.success){var s=e.data,a="";a+='<option value="'+SYSTEM_USERID+'">菜狗平台</option>';for(var t=0;t<s.length;t++){var r=s[t];a+='<option value="'+r.userId+'">'+r.loginName+"</option>"}$("#seller").html(a)}})}(),p()}function o(e){$(e).html('<div class="bg_fff" style="text-align: center;line-height: 150px;">暂时无法获取数据</div>')}function i(){var a="808047",t={userId:g};s.post(a,{json:t}).then(function(s){if(s.success){var a=s.data,t="",r=0,l=0;if(a.length){for(var t='<ul class="b_bd_b">',i=0,d=v.length;d>i;i++){var p=a[v[i]],c=0,m=0;p.product.price2&&+p.product.price2&&(c=+p.product.price2*+p.quantity),p.product.price3&&+p.product.price3&&(m=+p.product.price3*+p.quantity),r+=c,l+=m,t+='<li class="ptb8 clearfix b_bd_b plr10" modelCode="'+p.code+'"><a href="../operator/buy.html?code='+p.productCode+'" class="show p_r min-h100p"><div class="order-img-wrap tc default-bg"><img class="center-img1" src="'+e.getImg(p.product.advPic,1)+'"/></div><div class="order-right-wrap clearfix"><div class="fl wp60"><p class="tl line-tow">'+p.product.name+'</p></div><div class="fl wp40 tr s_10">',p.product.price2&&(t+='<p><span class="item_totalP">'+e.formatMoney(p.product.price2)+'</span><span class="t_40pe s_09 pl4">菜狗币</span></p>'),p.product.price3&&(t+='<p><span class="item_totalP">'+e.formatMoney(p.product.price3)+'</span><span class="t_40pe s_09 pl4">抵金券</span></p>'),t+='<p class="t_80">×<span>'+p.quantity+"</span></p></div></div></a></li>"}t+="</ul>",$("#cont").hide(),$("#items-cont").append(n.loadImg(t)),l&&$("#totalCgbAmount").html(e.formatMoney(r)).parent().parent().removeClass("hidden"),l&&($("#mAdd, #JFDiv").removeClass("hidden"),$("#totalJFAmount").html(e.formatMoney(l)))}else $("#cont").hide(),o("#items-cont")}else $("#cont").hide(),o("#items-cont")})}function d(){var a="808026",t={code:v};s.post(a,{json:t}).then(function(s){if(s.success){var a=s.data,t="";if(a.price2){var r=+a.price2*+f;$("#totalCgbAmount").html(e.formatMoney(r)).parent().parent().removeClass("hidden")}if(a.price3){$("#mAdd, #JFDiv").removeClass("hidden");var l=+a.price3*+f;$("#totalJFAmount").html(e.formatMoney(l))}t+='<ul class="b_bd_b"><li class="ptb8 clearfix b_bd_b plr10" modelCode="'+a.code+'"><a href="../operator/buy.html?code='+a.code+'" class="show p_r min-h100p"><div class="order-img-wrap tc default-bg"><img class="center-img1" src="'+e.getImg(a.advPic)+'"/></div><div class="order-right-wrap clearfix"><div class="fl wp60"><p class="tl line-tow">'+a.name+'</p><p class="tl pt4 line-tow">'+a.slogan+'</p></div><div class="fl wp40 tr s_10">',a.price2&&(t+='<p><span class="item_totalP">'+e.formatMoney(a.price2)+'</span><span class="t_40pe s_09 pl4">菜狗币</span></p>'),a.price3&&(t+='<p><span class="item_totalP">'+e.formatMoney(a.price3)+'</span><span class="t_40pe s_09 pl4">抵金券</span></p>'),t+='<p class="t_80">×<span>'+f+"</span></p></div></div></a></li></ul>",$("#items-cont").append(n.loadImg(t)),$("#cont").hide()}else o("#items-cont")})}function p(){$("#addressDiv").on("click","a",function(){"add-addr"==this.id?(sessionStorage.setItem("returnhref",location.href),location.href="./add_address.html?return=1"):(sessionStorage.setItem("returnhref",location.href),location.href="./address_list.html?c="+$(this).attr("code")+"&return=1")}),$("#sbtn").on("click",function(){var e=$("#addressDiv>a");return"1"!=$("#psfs").val()||e.length?$("#apply_note").val().length>255?void m("备注字数必须少于255位"):void c():void m("未选择地址")}),$("#psfs").on("change",function(){var e=$(this);"2"==e.val()?($("#zt").addClass("hidden"),$("#sj").removeClass("hidden"),$("#addressDiv").addClass("hidden"),$(".addressDivTitle").addClass("hidden")):($("#sj").addClass("hidden"),$("#zt").removeClass("hidden"),$("#addressDiv").removeClass("hidden"),$(".addressDivTitle").removeClass("hidden"))})}function c(){var e,s="808050";if(1==h){{1e3*+$("#items-cont").find(".item_totalP").text()}e={productCode:v,quantity:f}}else{if(2!=h)return void m("类型错误，无法提交订单");for(var a=[],t=$("#items-cont > ul > li"),r=0,n=t.length;n>r;r++)a.push($(t[r]).attr("modelCode"));var e={cartCodeList:a};s="808051"}u(e,s)}function m(e){var s=t({content:e,quickClose:!0});s.show(),setTimeout(function(){s.close().remove()},2e3)}function u(e,a){if("1"==$("#psfs").val())e.toUser=SYSTEM_USERID,e.pojo={receiver:y.addressee,reMobile:y.mobile,reAddress:y.province+y.city+y.district+y.detailAddress,applyUser:sessionStorage.getItem("userId"),applyNote:$("#apply_note").val()||"",companyCode:SYSTEM_CODE,systemCode:SYSTEM_CODE};else{if(e.toUser=$("#seller").val(),e.addressCode="",!e.toUser)return void m("商家不能为空");e.pojo={receiver:"",reMobile:"",reAddress:"",applyUser:sessionStorage.getItem("userId"),applyNote:$("#apply_note").val()||"",companyCode:SYSTEM_CODE,systemCode:SYSTEM_CODE}}s.post(a,{json:e}).then(function(e){if(e.success){var s=e.data||e.data.code;location.href="./pay_order.html?code="+s}else m(e.msg)})}var v=e.getUrlParam("code")||"",h=e.getUrlParam("type")||"1",f=e.getUrlParam("q")||"1",g=(a.get("receiptType"),sessionStorage.getItem("userId")),_=sessionStorage.getItem("token"),y={};l()});