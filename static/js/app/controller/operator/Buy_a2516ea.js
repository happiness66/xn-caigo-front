define("js/app/controller/operator/Buy",["js/app/controller/base","js/app/util/ajax","js/app/util/dialog","js/lib/swiper-3.3.1.jquery.min"],function(e,t,o,n){$(function(){function a(e){var t=o({content:e,quickClose:!0});t.show(),setTimeout(function(){t.close().remove()},2e3)}function c(){$("#subCount").on("click",function(){var t=$("#buyCount").val();(void 0==t||""==t||"0"==t||"1"==t)&&(t=2),t=+t-1,$("#buyCount").val(t),$("#buyCount").change();var o=v,n=$("#buyCount").val(),i=o.price2?e.formatMoney(o.price2*n)+"菜狗币":"",a=o.price3?e.formatMoney(o.price3*n)+"抵金券":"";$(".CGB").text(i),$(".JF").text(a)}),$("#addCount").on("click",function(){var t=$("#buyCount").val();(void 0==t||""==t)&&(t=0),t=+t+1,$("#buyCount").val(t),$("#buyCount").change();var o=v,n=$("#buyCount").val(),i=o.price2?e.formatMoney(o.price2*n)+"菜狗币":"",a=o.price3?e.formatMoney(o.price3*n)+"抵金券":"";$(".CGB").text(i),$(".JF").text(a)}),$("#buyCount").on("keyup",function(e){var t=e.charCode||e.keyCode,o=$(this);s(t)||u(t)||o.val(o.val().replace(/[^\d]/g,"")),o.val()||o.change()}).on("change",function(e){var t=e.charCode||e.keyCode,o=$(this);s(t)||u(t)||o.val(o.val().replace(/[^\d]/g,"")),o.val()||o.val("1"),"0"==o.val()&&o.val("1")})}function r(){var t=v,o=t.pic;if(o=o.split("||"),table_html="<tbody>",!d){var a="";$.each(o,function(t,o){a+='<div class="swiper-slide tc"><img src="'+e.getImg(o,1)+'"></div>'}),$("#btlImgs").append(a),d=new n(".swiper-container",{direction:"horizontal",pagination:".swiper-pagination"})}$("#btr-name").text(t.name),$("#btr-slogan").text(t.slogan);var c=t.price2?e.formatMoney(t.price2)+"菜狗币":"",r=t.price3?e.formatMoney(t.price3)+"抵金券":"";if($("#discountPrice").text(c),$("#cnyPrice").text(t.price2&&t.price3?"+"+r:r),$("#btr-description").append(t.description),t.productSpecs.length){var u="";for(i=0;i<t.productSpecs.length;i++)u+=0==t.productSpecs[i].dkey?'<div class="tit">'+t.productSpecs[i].dvalue+"</div>":'<div class="list">'+t.productSpecs[i].dvalue+"</div>";$("#productSpecs").html(u),$("#productSpecs").removeClass("hidden")}var s=$("#buyCount").val(),l=t.price2?e.formatMoney(t.price2*s)+"菜狗币":"",p=t.price3?e.formatMoney(t.price3*s)+"抵金券":"";$(".CGB").text(l),$(".JF").text(p)}function u(e){return e>=48&&57>=e||e>=96&&105>=e?!0:!1}function s(e){return 37==e||39==e||8==e||46==e?!0:!1}function l(){"1"==f?p():location.href="../user/login.html?return="+encodeURIComponent(location.pathname+location.search)}function p(){var e=m,n={userId:y,productCode:e||"",quantity:$("#buyCount").val()},i="808040";t.post(i,{json:n}).then(function(e){var t;t=e.success?"添加购物车成功!":"添加购物车失败!";var n=o({content:t,quickClose:!0});n.show(),setTimeout(function(){n.close().remove()},2e3)})}var d,v,f,m=e.getUrlParam("code")||"",y=sessionStorage.getItem("userId");e.getCartLength(),param={code:m},t.post("808026",{json:param}).then(function(e){if(e.success){var t=e.data;v=t,$("#buyBtn").click(function(){if(!$(this).hasClass("no-buy-btn")){var e=m;location.href="./submit_order.html?code="+e+"&q="+$("#buyCount").val()}}),$("#addCartBtn").click(function(){$(this).hasClass("no-buy-btn")||l()}),c(),r(),$("#cont").remove()}else a("暂无数据")}),"1"!==sessionStorage.getItem("user")?e.getUser().then(function(e){e.success&&(f=e.data)}):f=!0})});