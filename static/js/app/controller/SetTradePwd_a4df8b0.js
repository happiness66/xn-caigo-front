define("js/app/controller/SetTradePwd",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading"],function(n,e,i){function a(){$("#getVerification").addClass("cancel-send"),e.post("805904",{json:{mobile:sessionStorage.getItem("m"),bizType:"805045",kind:"f1"}}).then(function(n){if(n.success)for(var e=0;60>=e;e++)!function(n){setTimeout(function(){60>n?$("#getVerification").text(60-n+"s"):$("#getVerification").text("获取验证码").removeClass("cancel-send").one("click",a)},1e3*n)}(e);else{$("#getVerification").one("click",a);var i=$("#verification").parent(),s=i.find("span.warning")[2];$(s).fadeIn(150).fadeOut(3e3)}})}function s(){var n,e=$("#verification")[0],i=e.parentNode;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):/^[\d]{4}$/.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function t(){var n,e=$("#password")[0],i=e.parentNode,a=/^[^\s]{6,16}$/;return""==e.value?(n=$(i).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):a.test(e.value)?!0:(n=$(i).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1)}function o(){var n,e=$("#password")[0],i=$("#repassword")[0],a=i.parentNode;return""==i.value?(n=$(a).find("span.warning")[0],$(n).fadeIn(150).fadeOut(3e3),!1):i.value!==e.value?(n=$(a).find("span.warning")[1],$(n).fadeIn(150).fadeOut(3e3),!1):!0}function r(){return s()&&t()&&o()?!0:!1}function c(){n.showMsg("恭喜您，交易密码设置成功！"),setTimeout(function(){location.href="./user_info.html"},1e3)}function f(){if(r()){i.createLoading("设置中...");var a={tradePwd:$("#password").val(),smsCaptcha:$("#verification").val(),userId:n.getUserId(),tradePwdStrength:n.calculateSecurityLevel($("#password").val())};e.post("805045",{json:a}).then(function(e){i.hideLoading(),e.success?c():n.showMsg(e.msg)})}}$("#verification").on("change",s),$("#password").on("change",t).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#repassword").on("change",o).on("focus",function(){$(this).siblings(".register_verifycon").css({display:"block"})}).on("blur",function(){$(this).siblings(".register_verifycon").css({display:"none"})}),$("#sbtn").on("click",function(){f()}),$("#getVerification").one("click",a)});