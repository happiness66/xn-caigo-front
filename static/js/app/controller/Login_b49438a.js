define("js/app/controller/Login",["js/app/controller/base","js/app/util/ajax","js/app/module/loading/loading"],function(e,n,t){$(function(){function o(){f=e.getUrlParam("return"),f?($("#toRegister").attr("href","./register.html?return="+encodeURIComponent(f)),$("#fdPwd").attr("href","./findPwd.html?return="+encodeURIComponent(f))):($("#toRegister").attr("href","./register.html"),$("#fdPwd").attr("href","./findPwd.html"))}function a(){$("#loginBtn").on("click",c),$("#mobile").on("change",function(){r()}),$("#password").on("change",function(){s()}),$("#wxLogin").on("click",function(){t.createLoading(),i()})}function i(){n.get("806031",{companyCode:SYSTEM_CODE,account:"ACCESS_KEY",type:"3"}).then(function(n){if(n.success&&n.data.length){var o=n.data[0].password,a=location.origin+"/user/redirect.html";f&&(a=a+"?return="+encodeURIComponent(f)),location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+o+"&redirect_uri="+a+"&response_type=code&scope=snsapi_userinfo#wechat_redirect"}else t.hideLoading(),e.showMsg(n.msg||"非常抱歉，微信登录失败")},function(){t.hideLoading(),e.showMsg("非常抱歉，微信登录失败")})}function r(){var e,n=$("#mobile")[0],t=n.parentNode;return""==n.value?(e=$(t).find("span.warning")[0],$(e).fadeIn(150).fadeOut(3e3),!1):/^1[3,4,5,7,8]\d{9}$/.test(n.value)?!0:(e=$(t).find("span.warning")[1],$(e).fadeIn(150).fadeOut(3e3),!1)}function s(){var e,n=$("#password")[0],t=n.parentNode;return""==n.value?(e=$(t).find("span.warning")[0],$(e).fadeIn(150).fadeOut(3e3),!1):!0}function d(){return r()&&s()?!0:!1}function c(){if(d()){t.createLoading("登录中...");var o={loginName:$("#mobile").val(),loginPwd:$("#password").val(),kind:"f1"},a="805043";n.post(a,{json:o}).then(function(n){if(t.hideLoading(),n.success){sessionStorage.setItem("user","1"),sessionStorage.setItem("userId",n.data.userId),sessionStorage.setItem("token",n.data.token),setTimeout(function(){u()},2e3);var o=+n.data.amount||0;o>0?(e.showMsg("每天首次登录获得抵金券+"+ +o/1e3),setTimeout(function(){u()},2e3)):u()}else e.showMsg(n.msg),sessionStorage.setItem("user","0")})}}function u(){location.href=f?f:"./user_info.html"}var f;a(),o()})});